<div class="container my-5">
    <!-- Sayfa Başlığı -->
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/" class="text-decoration-none">Ana Sayfa</a></li>
                    <li class="breadcrumb-item active" aria-current="page"><%= category.name %></li>
                </ol>
            </nav>
            
            <div class="d-flex align-items-center justify-content-between flex-wrap">
                <div>
                    <h1 class="h2 mb-2"><%= category.name %></h1>
                    <% if (category.description) { %>
                        <p class="text-muted lead"><%= category.description %></p>
                    <% } %>
                    <p class="text-muted">
                        <i class="fas fa-box me-2"></i>
                        <%= products.length %> ürün bulundu
                    </p>
                </div>
                
                <div class="category-actions">
                    <div class="btn-group" role="group">
                        <input type="radio" class="btn-check" name="view-type" id="grid-view" autocomplete="off" checked>
                        <label class="btn btn-outline-primary" for="grid-view">
                            <i class="fas fa-th"></i>
                        </label>
                        
                        <input type="radio" class="btn-check" name="view-type" id="list-view" autocomplete="off">
                        <label class="btn btn-outline-primary" for="list-view">
                            <i class="fas fa-list"></i>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Filtreler -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" class="form-control" placeholder="Bu kategoride ara..." id="categorySearch">
                            </div>
                        </div>
                        
                        <div class="col-md-3">
                            <select class="form-select" id="sortSelect">
                                <option value="name-asc">A-Z Sıralama</option>
                                <option value="name-desc">Z-A Sıralama</option>
                                <option value="price-asc">Fiyat (Düşük-Yüksek)</option>
                                <option value="price-desc">Fiyat (Yüksek-Düşük)</option>
                                <option value="newest">En Yeni</option>
                            </select>
                        </div>
                        
                        <div class="col-md-3">
                            <select class="form-select" id="stockFilter">
                                <option value="all">Tüm Ürünler</option>
                                <option value="in-stock">Stokta Olanlar</option>
                                <option value="out-stock">Stokta Olmayanlar</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ürünler Grid Görünümü -->
    <div id="grid-view-content" class="products-grid">
        <% if (products && products.length > 0) { %>
            <div class="row g-4">
                <% products.forEach(product => { %>
                    <div class="col-lg-3 col-md-4 col-sm-6 product-item" 
                         data-name="<%= product.name.toLowerCase() %>"
                         data-price="<%= product.price || 0 %>"
                         data-stock="<%= product.stock || 0 %>"
                         data-created="<%= product.created_at %>">
                        <div class="card h-100 product-card">
                            <div class="product-image-container">
                                <% if (product.image_url) { %>
                                    <img src="<%= product.image_url %>" class="card-img-top product-image" alt="<%= product.name %>">
                                <% } else { %>
                                    <div class="placeholder-image d-flex align-items-center justify-content-center">
                                        <i class="fas fa-image text-muted" style="font-size: 3rem;"></i>
                                    </div>
                                <% } %>
                                
                                <div class="product-overlay">
                                    <a href="/urun/<%= product.id %>" class="btn btn-primary btn-sm">
                                        <i class="fas fa-eye me-2"></i>Detayları Gör
                                    </a>
                                </div>
                                
                                <% if (product.stock <= 0) { %>
                                    <div class="position-absolute top-0 end-0 m-2">
                                        <span class="badge bg-danger">Stokta Yok</span>
                                    </div>
                                <% } %>
                            </div>
                            
                            <div class="card-body d-flex flex-column">
                                <h6 class="card-title mb-2"><%= product.name %></h6>
                                <p class="card-text text-muted small flex-grow-1">
                                    <%= product.description ? (product.description.length > 80 ? product.description.substring(0, 80) + '...' : product.description) : 'Açıklama bulunmuyor' %>
                                </p>
                                
                                <div class="mt-auto">
                                    <% if (product.price) { %>
                                        <div class="price-tag mb-2">
                                            <span class="h5 text-primary mb-0">₺<%= parseFloat(product.price).toLocaleString('tr-TR', {minimumFractionDigits: 2}) %></span>
                                        </div>
                                    <% } %>
                                    
                                    <% if (product.colors) { %>
                                        <div class="color-options mb-2">
                                            <small class="text-muted">
                                                <i class="fas fa-palette me-1"></i>
                                                <%= product.colors.split(',').length %> renk seçeneği
                                            </small>
                                        </div>
                                    <% } %>
                                    
                                    <div class="d-flex justify-content-between align-items-center">
                                        <% if (product.stock > 0) { %>
                                            <small class="text-success">
                                                <i class="fas fa-check-circle me-1"></i>
                                                Stokta var
                                            </small>
                                        <% } else { %>
                                            <small class="text-danger">
                                                <i class="fas fa-times-circle me-1"></i>
                                                Stokta yok
                                            </small>
                                        <% } %>
                                        
                                        <a href="/urun/<%= product.id %>" class="btn btn-outline-primary btn-sm">
                                            Detay
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <div class="text-center py-5">
                <i class="fas fa-box-open text-muted mb-3" style="font-size: 4rem;"></i>
                <h4 class="text-muted">Bu kategoride henüz ürün bulunmuyor</h4>
                <p class="text-muted">Yakında yeni ürünler eklenecek!</p>
                <a href="/" class="btn btn-primary">
                    <i class="fas fa-arrow-left me-2"></i>
                    Ana Sayfaya Dön
                </a>
            </div>
        <% } %>
    </div>
    
    <!-- Ürünler Liste Görünümü -->
    <div id="list-view-content" class="products-list d-none">
        <% if (products && products.length > 0) { %>
            <% products.forEach(product => { %>
                <div class="card mb-3 product-item"
                     data-name="<%= product.name.toLowerCase() %>"
                     data-price="<%= product.price || 0 %>"
                     data-stock="<%= product.stock || 0 %>"
                     data-created="<%= product.created_at %>">
                    <div class="row g-0">
                        <div class="col-md-3">
                            <div class="product-image-container" style="height: 200px;">
                                <% if (product.image_url) { %>
                                    <img src="<%= product.image_url %>" class="img-fluid h-100 w-100" style="object-fit: cover;" alt="<%= product.name %>">
                                <% } else { %>
                                    <div class="placeholder-image d-flex align-items-center justify-content-center h-100">
                                        <i class="fas fa-image text-muted" style="font-size: 3rem;"></i>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="card-body h-100 d-flex flex-column">
                                <div class="d-flex justify-content-between align-items-start">
                                    <h5 class="card-title"><%= product.name %></h5>
                                    <% if (product.stock <= 0) { %>
                                        <span class="badge bg-danger">Stokta Yok</span>
                                    <% } else { %>
                                        <span class="badge bg-success">Stokta Var</span>
                                    <% } %>
                                </div>
                                
                                <p class="card-text text-muted">
                                    <%= product.description || 'Açıklama bulunmuyor' %>
                                </p>
                                
                                <div class="row mt-auto">
                                    <div class="col-md-6">
                                        <% if (product.price) { %>
                                            <h4 class="text-primary mb-2">₺<%= parseFloat(product.price).toLocaleString('tr-TR', {minimumFractionDigits: 2}) %></h4>
                                        <% } %>
                                        
                                        <% if (product.colors) { %>
                                            <p class="text-muted mb-2">
                                                <i class="fas fa-palette me-2"></i>
                                                Renk seçenekleri: <%= product.colors %>
                                            </p>
                                        <% } %>
                                        
                                        <p class="text-muted mb-0">
                                            <i class="fas fa-warehouse me-2"></i>
                                            Stok: <%= product.stock || 0 %> adet
                                        </p>
                                    </div>
                                    
                                    <div class="col-md-6 text-end">
                                        <a href="/urun/<%= product.id %>" class="btn btn-primary">
                                            <i class="fas fa-eye me-2"></i>
                                            Detayları Görüntüle
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <% }); %>
        <% } %>
    </div>
    
    <% if (products && products.length > 12) { %>
        <!-- Pagination (Gelecekte eklenebilir) -->
        <div class="d-flex justify-content-center mt-5">
            <nav aria-label="Ürün sayfaları">
                <ul class="pagination">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1">Önceki</a>
                    </li>
                    <li class="page-item active">
                        <a class="page-link" href="#">1</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#">Sonraki</a>
                    </li>
                </ul>
            </nav>
        </div>
    <% } %>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Görünüm değiştirme
    const gridViewBtn = document.getElementById('grid-view');
    const listViewBtn = document.getElementById('list-view');
    const gridContent = document.getElementById('grid-view-content');
    const listContent = document.getElementById('list-view-content');
    
    gridViewBtn.addEventListener('change', function() {
        if (this.checked) {
            gridContent.classList.remove('d-none');
            listContent.classList.add('d-none');
        }
    });
    
    listViewBtn.addEventListener('change', function() {
        if (this.checked) {
            listContent.classList.remove('d-none');
            gridContent.classList.add('d-none');
        }
    });
    
    // Arama fonksiyonu
    const searchInput = document.getElementById('categorySearch');
    const sortSelect = document.getElementById('sortSelect');
    const stockFilter = document.getElementById('stockFilter');
    
    function filterProducts() {
        const searchTerm = searchInput.value.toLowerCase();
        const sortBy = sortSelect.value;
        const stockFilter = document.getElementById('stockFilter').value;
        const productItems = document.querySelectorAll('.product-item');
        
        let visibleProducts = Array.from(productItems).filter(item => {
            const name = item.dataset.name;
            const stock = parseInt(item.dataset.stock);
            
            // Arama filtresi
            const matchesSearch = name.includes(searchTerm);
            
            // Stok filtresi
            let matchesStock = true;
            if (stockFilter === 'in-stock') {
                matchesStock = stock > 0;
            } else if (stockFilter === 'out-stock') {
                matchesStock = stock <= 0;
            }
            
            const shouldShow = matchesSearch && matchesStock;
            
            if (shouldShow) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
            
            return shouldShow;
        });
        
        // Sıralama
        visibleProducts.sort((a, b) => {
            switch (sortBy) {
                case 'name-asc':
                    return a.dataset.name.localeCompare(b.dataset.name);
                case 'name-desc':
                    return b.dataset.name.localeCompare(a.dataset.name);
                case 'price-asc':
                    return parseFloat(a.dataset.price) - parseFloat(b.dataset.price);
                case 'price-desc':
                    return parseFloat(b.dataset.price) - parseFloat(a.dataset.price);
                case 'newest':
                    return new Date(b.dataset.created) - new Date(a.dataset.created);
                default:
                    return 0;
            }
        });
        
        // Sıralanmış ürünleri yeniden düzenle
        const gridContainer = gridContent.querySelector('.row');
        const listContainer = listContent;
        
        visibleProducts.forEach(item => {
            if (item.parentNode === gridContainer) {
                gridContainer.appendChild(item);
            } else if (item.parentNode === listContainer) {
                listContainer.appendChild(item);
            }
        });
    }
    
    searchInput.addEventListener('input', filterProducts);
    sortSelect.addEventListener('change', filterProducts);
    document.getElementById('stockFilter').addEventListener('change', filterProducts);
});
</script>